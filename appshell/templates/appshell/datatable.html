<table id="{{table.name}}" 
       class="table table-striped table-hover datatable"
       {{table.attrs|xmlattr}}>
        <thead>
          {%if table.filters == 'top' %}
            <tr>
              {%for i in table.columns: %}
                <td>{{ i.get_filter_html(loop.index0, table) }}</td>
              {%endfor%}
            </tr>
          {%endif%}
          <tr>
            {%for i in table.columns: %}
              {{ i.header }}
            {%endfor%}
          </tr>
        </thead>
        <tbody>
          {%for i in table.data: %}
            {{i}}
          {%endfor%}
        </tbody>
        <tfoot>
          {%if table.filters == 'bottom' %}
            <tr>
              {%for i in table.columns: %}
                <td>{{ i.get_filter_html(loop.index0, table) }}</td>
              {%endfor%}
            </tr>
          {%endif%}
        </tfoot>
</table>
<script language="Javascript">
collected_onloads.push(function() {
    var t;
    var options = {{table.options|tojson}}
    var e = $({{("#"+table.name)|tojson}})
    {%if "scrollY" in table.options and table.options["scrollY"] < 0: %}
      options["scrollY"] = $(window).height() + {{table.options["scrollY"]}};
    {%endif%}

    {%if table.filters:%}
       options["searchCols"] = {{table.default_filters()|tojson}}
    {%endif%}

    e.parents('.dropdown').on('shown.bs.dropdown', function(){
      t.draw();
    })
    var t = e.DataTable(options);
    {%if "fixed_header" in table.options:%}
      var fho = {"offsetTop": 50};
      {%for k, v in table.options.fixed_header.iteritems(): %}
        fho[{{k|tojson}}] = {{v|tojson}};
      {%endfor%}
      new $.fn.dataTable.FixedHeader(t, fho);
    {%endif%}
    appshell.datatables[{{table.name|tojson}}] = t;
  });
</script>
